{
  "comments": [
    {
      "key": {
        "uuid": "1a2f8d8d_4a20769b",
        "filename": "qemu/migration/migration.c",
        "patchSetId": 1
      },
      "lineNbr": 1008,
      "author": {
        "id": 1453
      },
      "writtenOn": "2015-09-24T17:48:31Z",
      "side": 1,
      "message": "`end_time\u0027 is now set when the state might not be `MIGRATION_STATUS_COMPLETED\u0027, is this OK.",
      "revId": "738df5b97312bb61617669250ce67073108de070",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a2f8d8d_6ad8d253",
        "filename": "qemu/migration/migration.c",
        "patchSetId": 1
      },
      "lineNbr": 1008,
      "author": {
        "id": 2165
      },
      "writtenOn": "2015-09-25T02:03:38Z",
      "side": 1,
      "message": "Yes, it is OK and necessary because qemu_savevm_sate_cancel is a time consuming operation, we should get the end_time before qemu_savevm_state_cancel to make the downtime as accurate as possible. Please note that when qemu_savevm_state_cancel called, all the data transmission has already done.",
      "parentUuid": "1a2f8d8d_4a20769b",
      "revId": "738df5b97312bb61617669250ce67073108de070",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a2f8d8d_2a252aab",
        "filename": "qemu/migration/migration.c",
        "patchSetId": 1
      },
      "lineNbr": 1011,
      "author": {
        "id": 1453
      },
      "writtenOn": "2015-09-24T17:48:31Z",
      "side": 1,
      "message": "In the old code `qemu_savem_state_cancel\u0027 would only be called when the state was not `MIRATION_STATUS_COMPLETED\u0027 but now it could be called in that state, that seems wrong.",
      "revId": "738df5b97312bb61617669250ce67073108de070",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a2f8d8d_2ae2ca03",
        "filename": "qemu/migration/migration.c",
        "patchSetId": 1
      },
      "lineNbr": 1011,
      "author": {
        "id": 2165
      },
      "writtenOn": "2015-09-25T02:03:38Z",
      "side": 1,
      "message": "No, it\u0027s not wrong. The old code call \u0027migration_end\u0027 in two places, one is in \u0027ram_save_complete\u0027, and another one is in \u0027qemu_savevm_state_cancel\u0027. when live migration is success, \u0027migraiton_end\u0027 will be called in \u0027ram_save_complete\u0027, if failed or cancel, \u0027migration_end\u0027 will be call in \u0027qemu_save_state_cancel\u0027, so \u0027migration_end\u0027 will be called no matter the \u0027state\u0027 was \u0027MIRATION_STATUS_COMPLETED\u0027 or other value. My code just call \u0027migraiton_end\u0027 directly and ignore the \u0027state\u0027 value, there is no behavior change.",
      "parentUuid": "1a2f8d8d_2a252aab",
      "revId": "738df5b97312bb61617669250ce67073108de070",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    }
  ]
}